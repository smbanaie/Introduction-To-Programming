# مفسر پایتون: چگونه کد پایتون اجرا می‌شود

## مفسر پایتون چیست؟

مفسر پایتون برنامه‌ای است که کد پایتون را می‌خواند و اجرا می‌کند. برخلاف زبان‌های کامپایل شده که کد را قبل از اجرای آن ترجمه می‌کنند، پایتون کد را خط به خط ترجمه کرده و اجرا می‌کند.

## فرآیند اجرای پایتون

### کد منبع (.py) → مفسر → اجرا

وقتی `python script.py` را اجرا می‌کنید، چندین اتفاق می‌افتد:

۱. **راه‌اندازی مفسر**: پایتون مفسر را بارگذاری می‌کند
۲. **خواندن منبع**: فایل .py شما را خط به خط می‌خواند
۳. **تحلیل لغوی**: کد را به توکن‌ها (کلمات کلیدی، شناسه‌ها، عملگرها) تقسیم می‌کند
۴. **تجزیه**: درخت نحو انتزاعی (AST) ایجاد می‌کند
۵. **کامپایل**: AST را به بایت‌کد (.pyc) تبدیل می‌کند
۶. **اجرا**: ماشین مجازی پایتون (PVM) بایت‌کد را اجرا می‌کند
۷. **خروجی**: نتایج نمایش داده شده یا ذخیره می‌شوند

## حالت تعاملی در برابر حالت اسکریپت

### حالت تعاملی (REPL)
```bash
$ python3
>>> print("Hello")
Hello
>>> x = 5 + 3
>>> print(x)
8
>>>
```

**ویژگی‌ها:**
- بازخورد فوری
- عالی برای تست قطعه کدهای کوچک
- نیازی به ذخیره فایل‌ها نیست
- کامل برای یادگیری و آزمایش

### حالت اسکریپت
```bash
# hello.py
print("Hello, World!")
name = input("What's your name? ")
print(f"Nice to meet you, {name}!")
```

```bash
$ python3 hello.py
Hello, World!
What's your name? Alice
Nice to meet you, Alice!
```

**ویژگی‌ها:**
- برنامه‌های کامل
- می‌توان چندین بار اجرا کرد
- بهتر برای برنامه‌های پیچیده
- آسان‌تر برای اشتراک‌گذاری و توزیع

## ماشین مجازی پایتون (PVM)

### PVM چیست؟
ماشین مجازی پایتون موتور زمان اجرایی است که بایت‌کد پایتون را اجرا می‌کند. مانند کامپیوتری در داخل کامپیوتر شما است که مخصوصاً برای پایتون طراحی شده.

### چگونه کار می‌کند؟
```
کد منبع پایتون
        ↓
    بایت‌کد (.pyc)
        ↓
ماشین مجازی پایتون
        ↓
    دستورالعمل‌های ماشین
        ↓
        CPU
```

### کش کردن بایت‌کد
پایتون به طور خودکار بایت‌کد را برای سرعت بخشیدن به اجرای بعدی کش می‌کند:
- اجرای اول: `script.py` → `script.pyc` → اجرا
- اجرای بعدی: کامپایل را رد کند، از `script.pyc` کش شده استفاده کند
- مکان کش: دایرکتوری `__pycache__/`

## پیاده‌سازی‌های پایتون

### CPython (پیش‌فرض)
- به زبان C نوشته شده
- پرکاربردترین
- پیاده‌سازی مرجع
- شامل GIL (Global Interpreter Lock)

### PyPy
- پیاده‌سازی جایگزین
- کامپایلر Just-In-Time (JIT)
- سریع‌تر برای برنامه‌های طولانی‌مدت
- مدیریت حافظه متفاوت

### Jython
- روی ماشین مجازی جاوا اجرا می‌شود
- با کتابخانه‌های جاوا ادغام می‌شود
- خوب برای قابلیت همکاری جاوا

### IronPython
- روی Common Language Runtime دات‌نت اجرا می‌شود
- با کتابخانه‌های دات‌نت ادغام می‌شود
- خوب برای توسعه ویندوز

## نسخه‌های پایتون

### پایتون ۲ در برابر پایتون ۳
- **پایتون ۲**: قدیمی، متوقف شده (EOL ژانویه ۲۰۲۰)
- **پایتون ۳**: فعلی، به طور فعال توسعه می‌یابد
- **تفاوت‌های کلیدی**: تابع print، Unicode، تقسیم عدد صحیح

### سازگاری نسخه
```python
# بررسی نسخه پایتون
import sys
print(f"Python version: {sys.version}")

# کد مخصوص نسخه
if sys.version_info >= (3, 6):
    print("f-strings available")
```

## تنظیم محیط

### گزینه‌های نصب

#### پایتون رسمی
```bash
# دانلود از python.org
# نصب با تنظیمات پیش‌فرض
# اضافه کردن به متغیر محیطی PATH
```

#### Anaconda/Miniconda
```bash
# نصب Anaconda
# شامل پایتون + کتابخانه‌های علمی
# ایجاد محیط مجازی به راحتی
```

#### مدیریت‌کنندگان بسته
```bash
# Ubuntu/Debian
sudo apt install python3

# macOS (Homebrew)
brew install python3

# Windows (Chocolatey)
choco install python3
```

### محیط‌های مجازی
```bash
# ایجاد محیط ایزوله
python3 -m venv myproject

# فعال‌سازی محیط
# Windows
myproject\Scripts\activate
# macOS/Linux
source myproject/bin/activate

# نصب بسته‌ها به صورت محلی
pip install requests
```

## اجرای کد پایتون

### گزینه‌های خط فرمان
```bash
# اجرای اسکریپت
python3 script.py

# اجرای با هشدارها
python3 -W error script.py

# اجرای ماژول
python3 -m module_name

# بررسی نحو بدون اجرا
python3 -m py_compile script.py

# اجرای تعاملی
python3 -i script.py
```

### IDE و ویرایشگرها
- **VS Code**: محبوب، رایگان، قابل توسعه
- **PyCharm**: IDE حرفه‌ای
- **Jupyter Notebook**: محاسبات تعاملی
- **IDLE**: ویرایشگر ساده همراه پایتون
- **Sublime Text**: سبک، سریع

## مدیریت خطا و اشکال‌زدایی

### خطاهای نحوی
```python
# دو نقطه گمشده
if x > 5
    print("Big")

# خطا: SyntaxError: invalid syntax
```

### خطاهای زمان اجرا
```python
# تقسیم بر صفر
result = 10 / 0
# ZeroDivisionError: division by zero
```

### خطاهای منطقی
```python
# محاسبه اشتباه
average = total / count  # اگر count برابر ۰ باشد
# ممکن است ZeroDivisionError ایجاد کند
```

### ابزارهای اشکال‌زدایی
```python
# اضافه کردن دستورات print
def calculate_average(scores):
    print(f"Input scores: {scores}")
    total = sum(scores)
    print(f"Total: {total}")
    count = len(scores)
    print(f"Count: {count}")
    average = total / count
    print(f"Average: {average}")
    return average

# استفاده از اشکال‌زدای pdb
import pdb
pdb.set_trace()  # اضافه کردن نقطه شکست
```

## ملاحظات عملکرد

### سربار مفسر
- پایتون کندتر از زبان‌های کامپایل شده است
- اما توسعه بسیار سریع‌تر است
- برای نمونه‌سازی استفاده کنید، سپس تنگاها را بهینه‌سازی کنید

### استراتژی‌های بهینه‌سازی
```python
# استفاده از توابع داخلی (سریع)
sum(my_list)  # به جای حلقه دستی

# استفاده از لیست comprehensions
squares = [x*x for x in numbers]  # به جای حلقه

# پروفایل عملکرد
import cProfile
cProfile.run('my_function()')
```

### چه زمانی از پیاده‌سازی‌های مختلف استفاده کنید
- **CPython**: عمومی، کتابخانه‌های بیشتر موجود
- **PyPy**: برنامه‌های طولانی‌مدت، کد محاسباتی
- **Jython**: ادغام با سیستم‌های جاوا
- **IronPython**: ادغام با ویندوز/.NET

## پایتون در محیط‌های مختلف

### توسعه وب
```python
# برنامه وب Flask
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello, Web!"

if __name__ == '__main__':
    app.run()
```

### علوم داده
```python
# نوت‌بوک Jupyter
import pandas as pd
import matplotlib.pyplot as plt

# بارگذاری و تحلیل داده
data = pd.read_csv('data.csv')
data.plot()
plt.show()
```

### اسکریپت‌های اتوماسیون
```python
# اتوماسیون سیستم
import os
import shutil

# سازماندهی فایل‌ها
for file in os.listdir('.'):
    if file.endswith('.txt'):
        shutil.move(file, 'text_files/')
```

## نکات کلیدی

۱. **پایتون از مفسر استفاده می‌کند**: کد خط به خط ترجمه و اجرا می‌شود
۲. **پیاده‌سازی‌های متعدد موجود است**: CPython، PyPy، Jython، IronPython
۳. **حالت تعاملی و اسکریپت**: REPL برای آزمایش، اسکریپت برای برنامه‌ها
۴. **محیط‌های مجازی**: وابستگی‌های پروژه را ایزوله کنید
۵. **معامله عملکرد**: اجرای کندتر، توسعه سریع‌تر

## مطالعه بیشتر
- مستندات رسمی پایتون (docs.python.org)
- پیشنهادات بهبود پایتون (PEPها)
- پیاده‌سازی‌های جایگزین پایتون
- تکنیک‌های بهینه‌سازی عملکرد