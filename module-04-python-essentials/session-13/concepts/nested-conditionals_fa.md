# شرایط تو در تو: تصمیم‌های داخل تصمیم‌ها

## چه چیزهایی یاد خواهید گرفت
- چگونه دستورات if را داخل دستورات if دیگر قرار دهید
- چه زمانی از شرایط تو در تو در مقابل عملگرهای منطقی استفاده کنید
- چگونه از «جهنم تورفتگی» فرار کنید
- الگوهای رایج برای تصمیم‌های تو در تو
- مثال‌های عملی

---

## مفهوم اصلی: سوالات به سوالات بیشتر منجر می‌شوند

گاهی اوقات یک تصمیم به تصمیم دیگری منجر می‌شود. شما یک شرط را بررسی می‌کنید، و اگر درست باشد، باید شرط دیگری را بررسی کنید. این کار **تو در تو** (nesting) نامیده می‌شود.

**مثال: کتاب انتخاب ماجرای خود**
- اگر می‌خواهی وارد غار شوی به صفحه ۵ برو
- در صفحه ۵: اگر چراغ دارید به صفحه ۱۰ بروید، یا اگر ندارید به صفحه ۱۵
- هر انتخاب به انتخاب‌های بیشتری منجر می‌شود!

---

## تو در تو پایه: if داخل if

### تو در تو ساده دو سطحی

```python
سن = 20
کارت_دارد = True

if سن >= 18:
    print("تو بزرگسال هستی.")
    
    if کارت_دارد:
        print("می‌توانی وارد باشگاه شوی!")
    else:
        print("برای ورود به کارت نیاز داری.")
        
else:
    print("تو خیلی جوان هستی برای ورود.")
```

**چه اتفاقی می‌افتد:**
۱. بررسی می‌کند آیا سن >= 18 → بله
۲. چاپ می‌کند «تو بزرگسال هستی»
۳. بررسی می‌کند آیا کارت_دارد → بله
۴. چاپ می‌کند «می‌توانی وارد باشگاه شوی!»

### سه سطح تو در تو

```python
دما = 75
آب_وهوا = "آفتابی"
آخر_هفته_هست = True

if دما > 70:
    print("هوا گرم است.")
    
    if آب_وهوا == "آفتابی":
        print("آب‌وهوای عالی!")
        
        if آخر_هفته_هست:
            print("برو ساحل!")
        else:
            print("روز کاری خوبی داشته باش.")
            
    else:
        print("گرم اما ابری.")
        
else:
    print("هوا خنک است.")
```

---

## چه زمانی از تو در تو در مقابل عملگرهای منطقی استفاده کنیم

### از عملگرهای منطقی برای شرایط AND ساده استفاده کنید

```python
# ✅ خوب - شرط ساده
if سن >= 18 and کارت_دارد:
    print("می‌توانی وارد شوی!")
else:
    print("نمی‌توانی وارد شوی.")
```

### از تو در تو برای پیام‌های متفاوت استفاده کنید

```python
# ✅ خوب - پیام‌های متفاوت برای شکست‌های مختلف
if سن >= 18:
    if کارت_دارد:
        print("به باشگاه خوش آمدید!")
    else:
        print("متأسفانه، برای ورود به کارت نیاز دارید.")
else:
    print("متأسفانه، باید ۱۸ سال یا بیشتر داشته باشید.")
    print(f"{18 - سن} سال دیگر بیا!")
```

---

## الگوهای رایج

### الگوی ۱: ابتدا پیش‌نیازها را بررسی کنید

```python
# بررسی اینکه آیا کاربر وجود دارد قبل از بررسی چیزهای دیگر
نام_کاربری = "علی"
رمز = "secret123"
حساب_فعال = True

# پایگاه داده شبیه‌سازی شده
پایگاه_داده = {
    "علی": {"رمز": "secret123", "فعال": True}
}

if نام_کاربری in پایگاه_داده:
    کاربر = پایگاه_داده[نام_کاربری]
    
    if رمز == کاربر["رمز"]:
        
        if کاربر["فعال"]:
            print("ورود موفق!")
        else:
            print("حساب غیرفعال است.")
            
    else:
        print("رمز اشتباه.")
        
else:
    print("نام کاربری یافت نشد.")
```

### الگوی ۲: ابتدا دسته‌بندی کنید، بعد تصمیم بگیرید

```python
نمره = 85
حضور_و_غیاب = 90

# ابتدا بر اساس نمره دسته‌بندی کنید
if نمره >= 90:
    نتیجه = "عالی"
elif نمره >= 80:
    نتیجه = "خوب"
elif نمره >= 70:
    نتیجه = "متوسط"
else:
    نتیجه = "ضعیف یا مردود"

# بعد حضور و غیاب را بررسی کنید
if حضور_و_غیاب >= 90:
    پاداش_حضور = "+"
else:
    پاداش_حضور = ""

print(f"نتیجه نهایی: {نتیجه}{پاداش_حضور}")
```

### الگوی ۳: سیستم منو

```python
print("=== سیستم سفارش غذا ===")
print("۱. پیتزا")
print("۲. برگر")
print("۳. سالاد")

انتخاب = input("انتخاب کن (۱-۳): ")

if انتخاب == "1":
    print("گزینه‌های پیتزا:")
    print("  الف. پپرونی")
    print("  ب. پنیر")
    print("  ج. سبزیجات")
    
    topping = input("انتخاب topping (الف-ج): ")
    
    if topping == "الف":
        print("پیتزای پپرونی سفارش دادی!")
    elif topping == "ب":
        print("پیتزای پنیر سفارش دادی!")
    elif topping == "ج":
        print("پیتزای سبزیجات سفارش دادی!")
    else:
        print("انتخاب topping نامعتبر.")
        
elif انتخاب == "2":
    print("برگر سفارش دادی!")
    
elif انتخاب == "3":
    print("سالاد سفارش دادی!")
    
else:
    print("انتخاب نامعتبر.")
```

---

## اجتناب از «جهنم تورفتگی»

### سطوح زیاد = خواندن سخت

```python
# ❌ سخت برای دنبال کردن (الگوی «فلش»)
if کاربر_موجود_هست:
    if کاربر.فعال_هست:
        if کاربر.اجازه_دارد:
            if کاربر.سهمیه > 0:
                if not کاربر.ممنوع_هست:
                    کاری_انجام_بده()
                else:
                    print("کاربر ممنوع است")
            else:
                print("سهمیه تمام شده")
        else:
            print("اجازه ندارد")
    else:
        print("کاربر غیرفعال")
else:
    print("کاربر یافت نشد")
```

### بهتر: با return یا عملگرهای منطقی صاف کنید

```python
# ✅ بهتر - ابتدا منفی‌ها را بررسی کنید و زود برگردید
if not کاربر_موجود_هست:
    print("کاربر یافت نشد")
elif not کاربر.فعال_هست:
    print("کاربر غیرفعال")
elif not کاربر.اجازه_دارد:
    print("اجازه ندارد")
elif کاربر.سهمیه <= 0:
    print("سهمیه تمام شده")
elif کاربر.ممنوع_هست:
    print("کاربر ممنوع است")
else:
    کاری_انجام_بده()
```

---

## اشتباهات رایج مبتدی‌ها

### اشتباه ۱: سطح تورفتگی اشتباه

```python
# ❌ اشتباه - else با if درستی match نمی‌شود
if سن >= 18:
    if کارت_دارد:
        print("می‌تواند وارد شود")
    else:  # این با if داخلی match می‌شود!
        print("به کارت نیاز دارد")
else:  # این با if بیرونی match می‌شود
    print("خیلی جوان است")
```

### اشتباه ۲: فراموش کردن شرط بیرونی

```python
# ❌ اشتباه - این حتی اگر سن < 18 هم اجرا می‌شود!
if سن >= 18:
    print("بزرگسال")
if کارت_دارد:  # این داخل بررسی سن نیست!
    print("می‌تواند وارد شود")
```

### اشتباه ۳: تو در تو کردن بیش از حد منطق ساده

```python
# ❌ بیش از حد پیچیده
if دما > 70:
    if آب_وهوا == "آفتابی":
        if آخر_هفته_هست:
            print("برو بیرون!")
        else:
            print("روز کاری")
    else:
        print("ابری")
else:
    print("سرد")

# ✅ ساده‌تر با عملگرهای منطقی
if دما > 70 and آب_وهوا == "آفتابی" and آخر_هفته_هست:
    print("برو بیرون!")
elif دما > 70 and آب_وهوا == "آفتابی":
    print("روز کاری")
elif دما > 70:
    print("ابری")
else:
    print("سرد")
```

### اشتباه ۴: رسیدگی نکردن به همه موارد

```python
# ❌ موارد گم شده
if انتخاب == "1":
    if زیر_انتخاب == "الف":
        print("گزینه ۱الف")
    elif زیر_انتخاب == "ب":
        print("گزینه ۱ب")
    # اگر زیر_انتخاب نه الف باشد نه ب چطور؟
```

---

## خودتان امتحان کنید: تمرین‌ها

### تمرین ۱: سیستم ورود به باشگاه

سیستمی بسازید که سن، کارت و لباس را بررسی کند:

```python
سن = int(input("سن خود را وارد کن: "))
کارت_دارد = input("کارت دارید؟ (بله/خیر): ").lower() == "بله"

if سن >= 21:
    if کارت_دارد:
        لباس_مناسب = input("لباس مناسب پوشیدید؟ (بله/خیر): ").lower()
        if لباس_مناسب == "بله":
            print("به باشگاه VIP خوش آمدید!")
        else:
            print("متأسفانه، لباس مناسب لازم است.")
    else:
        print("برای ورود کارت لازم است.")
elif سن >= 18:
    print("می‌توانید وارد محوطه معمولی شوید.")
else:
    print("برای ورود خیلی جوان هستید.")
```

### تمرین ۲: سیستم نمره‌دهی آزمون

امتحان را بر اساس چند فاکتور نمره‌دهی کنید:

```python
نمره = int(input("نمره را وارد کن (۰-۱۰۰): "))
تلاش‌ها = int(input("چند تلاش؟ "))

if نمره >= 70:
    if تلاش‌ها == 1:
        print("عالی! قبول در اولین تلاش!")
    else:
        print(f"بعد از {تلاش‌ها} تلاش قبول شد.")
else:
    if نمره >= 50:
        print("نزدیک! تمرین بیشتری لازم است.")
    else:
        print("مردود. لطفاً مطالب را مرور کنید.")
```

### تمرین ۳: شبیه‌سازی ATM

ATM ساده با بررسی موجودی و برداشت:

```python
موجودی = 1000
رمز = "1234"

رمز_وارد شده = input("رمز را وارد کن: ")

if رمز_وارد شده == رمز:
    print("دسترسی مجاز.")
    print(f"موجودی شما: ${موجودی}")
    
    عمل = input("برداشت یا واریز؟ (ب/و): ").lower()
    
    if عمل == "ب":
        مبلغ = int(input("مبلغ برداشت: $"))
        if مبلغ <= موجودی:
            موجودی = موجودی - مبلغ
            print(f"${مبلغ} برداشت شد. موجودی جدید: ${موجودی}")
        else:
            print("موجودی ناکافی!")
    elif عمل == "و":
        مبلغ = int(input("مبلغ واریز: $"))
        موجودی = موجودی + مبلغ
        print(f"${مبلغ} واریز شد. موجودی جدید: ${موجودی}")
    else:
        print("عمل نامعتبر.")
        
else:
    print("رمز اشتباه.")
```

### تمرین ۴: رفع اشکالات

```python
# برنامه با اشکال
سن = int(input("سن: "))
بلیط_دارد = input("بلیط دارید؟ ") == "بله"

if سن >= 18:
    print("بزرگسال")
if بلیط_دارد:
    print("می‌تواند وارد شود")
else:
    print("به بلیط نیاز دارد")
else:
    print("صغیر")
```

<details>
<summary>برای دیدن پاسخ کلیک کنید</summary>

```python
# برنامه رفع شده
سن = int(input("سن: "))
بلیط_دارد = input("بلیط دارید؟ ").lower() == "بله"

if سن >= 18:
    print("بزرگسال")
    if بلیط_دارد:  # این باید داخل بررسی سن باشد
        print("می‌تواند وارد شود")
    else:
        print("به بلیط نیاز دارد")
else:
    print("صغیر")
```
</details>

---

## مرجع سریع

### ساختار تو در تو

```python
if شرط۱:
    # کد برای شرط۱
    if شرط۲:
        # کد برای هر دو شرط
    else:
        # شرط۱ درست، شرط۲ نادرست
else:
    # شرط۱ نادرست
```

### چه زمانی از چه چیزی استفاده کنیم

| موقعیت | استفاده |
|--------|---------|
| بررسی AND ساده | `if a and b:` |
| پیام‌های متفاوت برای هر بررسی | ifهای تو در تو |
| بررسی‌های مستقل جداگانه | ifهای جداگانه (نه تو در تو) |
| درخت تصمیم پیچیده | ifهای تو در تو با elif |

### سطوح تورفتگی

```python
# سطح ۱: if بیرونی
if سن >= 18:
    # سطح ۲: داخل if اول
    if کارت_دارد:
        # سطح ۳: داخل if دوم
        print("وارد شو")
    else:
        # سطح ۳: داخل else if دوم
        print("به کارت نیاز دارد")
else:
    # سطح ۲: داخل else if اول
    print("خیلی جوان است")
```

---

## نکات کلیدی

۱. **تو در تو** یعنی قرار دادن ifها داخل ifهای دیگر
۲. **از تو در تو** وقتی استفاده کنید که برای بررسی‌های مختلف به پیام‌های متفاوت نیاز دارید
۳. **از عملگرهای منطقی** (`and`، `or`) برای شرایط ترکیبی ساده استفاده کنید
۴. **از سطوح زیاد اجتناب کنید**—خواندن و دیباگ سخت می‌شود
۵. **تورفتگی حیاتی است**—نشان می‌دهد کدام کد به کدام if تعلق دارد
۶. **وقتی ممکن است صاف کنید**—ابتدا موارد منفی را بررسی کنید و از `elif` استفاده کنید

---

## گام بعدی

حالا که شرایط تو در تو را درک کردید:
- درباره حلقه‌ها یاد می‌گیرید (تکرار کد)
- شرایط را با حلقه‌ها ترکیب می‌کنید
- برنامه‌های تعاملی‌تر می‌نویسید
