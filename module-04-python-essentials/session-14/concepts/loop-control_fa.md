# کنترل حلقه: Break، Continue و Else

## چه چیزهایی یاد خواهید گرفت
- چگونه با `break` زودتر از حلقه خارج شوید
- چگونه با `continue` از تکرارها بگذرید
- چگونه از بند `else` با حلقه‌ها استفاده کنید
- الگوهای رایج کنترل حلقه
- مثال‌های عملی از حلقه‌های کنترل‌شده

---

## مفهوم اصلی: کنترل حلقه‌های خود

گاهی اوقات نیاز دارید جریان عادی یک حلقه را تغییر دهید:
- **زودتر متوقف شوید** وقتی چیزی را پیدا کردید (`break`)
- **آیتم‌ها را رد کنید** که شرایط خاصی ندارند (`continue`)
- **کاری خاص انجام دهید** وقتی حلقه به طور عادی تمام می‌شود (`else`)

**مثال: جستجو در کتابخانه**
- `break`: وقتی کتاب را پیدا کردید، دیگر نگردید
- `continue`: کتاب‌های آسیب‌دیده را رد کنید و سراغ بعدی بروید
- `else`: اگر کل کتابخانه را گشتید و پیدا نکردید، آنلاین سفارش دهید

---

## دستور `break`: خروج فوری

`break` فوراً حلقه فعلی را متوقف می‌کند و با کد بعد از حلقه ادامه می‌دهد.

### پیدا کردن آیتم و توقف

```python
میوه‌ها = ["سیب", "موز", "گیلاس", "خرما", "زرشک"]
هدف = "گیلاس"

for میوه in میوه‌ها:
    print(f"در حال بررسی: {میوه}")
    
    if میوه == هدف:
        print(f"پیدا شد!")
        break  # فوراً متوقف شو

print("جستجو تمام شد")

# خروجی:
# در حال بررسی: سیب
# در حال بررسی: موز
# در حال بررسی: گیلاس
# پیدا شد!
# جستجو تمام شد
```

### جستجو با تأیید کاربر

```python
آیتم‌ها = ["مداد", "خودکار", "پاک‌کن", "خط‌کش", "ماژیک"]

while True:
    جستجو = input("به دنبال چه چیزی می‌گردید؟ (یا 'خروج'): ")
    
    if جستجو == "خروج":
        break
    
    پیدا_شد = False
    for آیتم in آیتم‌ها:
        if آیتم == جستجو:
            print(f"پیدا شد: {آیتم}")
            پیدا_شد = True
            break  # توقف جستجو
    
    if not پیدا_شد:
        print("موجود نیست")
```

### پیدا کردن اولین تطابق

```python
اعداد = [4, 2, 7, 1, 9, 5]

# پیدا کردن اولین عدد بزرگ‌تر از ۵
for عدد in اعداد:
    if عدد > 5:
        print(f"اولین عدد > ۵: {عدد}")
        break
else:
    print("عددی بزرگ‌تر از ۵ پیدا نشد")
```

---

## دستور `continue`: رد کردن و ادامه

`continue` بقیه تکرار فعلی را رد می‌کند و به تکرار بعدی می‌رود.

### رد کردن اعداد زوج

```python
اعداد = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

print("فقط اعداد فرد:")
for عدد in اعداد:
    if عدد % 2 == 0:  # اگر زوج بود
        continue  # اعداد زوج را رد کن
    print(عدد)

# خروجی: ۱، ۳، ۵، ۷، ۹
```

### رد کردن ورودی خالی یا نامعتبر

```python
خطوط = [
    "سلام دنیا",
    "",
    "   ",
    "پایتون جذاب است",
    "",
    "به یادگیری ادامه بده"
]

print("فقط خطوط معتبر:")
for خط in خطوط:
    if خط.strip() == "":  # رد کردن خطوط خالی
        continue
    print(f"→ {خط}")

# خروجی:
# → سلام دنیا
# → پایتون جذاب است
# → به یادگیری ادامه بده
```

### پردازش فقط داده‌های معتبر

```python
data = [10, "x", 20, "y", 30, "z"]

مجموع = 0
for آیتم in data:
    if not isinstance(آیتم, int):
        print(f"رد کردن غیرعدد: {آیتم}")
        continue
    
    مجموع += آیتم
    print(f"اضافه شد {آیتم}، مجموع فعلی: {مجموع}")

print(f"مجموع نهایی: {مجموع}")
```

---

## بند `else` با حلقه‌ها

بند `else` وقتی اجرا می‌شود که حلقه به **طور عادی** تمام شود (نه با `break`).

### استفاده از `else` برای "پیدا نشد"

```python
میوه‌ها = ["سیب", "موز", "گیلاس"]
جستجو = "خرما"

for میوه in میوه‌ها:
    if میوه == جستجو:
        print(f"پیدا شد: {میوه}")
        break
else:
    # این فقط اگر حلقه بدون break تمام شود اجرا می‌شود
    print(f"{جستجو} در لیست پیدا نشد!")

# خروجی: خرما در لیست پیدا نشد!
```

### اعتبارسنجی اعداد اول

```python
def اول_است(n):
    """بررسی اینکه آیا عدد اول است."""
    if n < 2:
        return False
    
    for i in range(2, n):
        if n % i == 0:
            print(f"{n} = {i} × {n//i}")
            return False
    
    return True

# تست
for عدد in [7, 10, 13, 15]:
    if اول_است(عدد):
        print(f"{عدد} اول است")
    else:
        print(f"{عدد} اول نیست")
```

### اعتبارسنجی رمز عبور

```python
رمز = input("رمز را وارد کن: ")
تلاش‌ها = 3

for تلاش in range(تلاش‌ها):
    if رمز == "secret":
        print("دسترسی مجاز!")
        break
    
    باقیمانده = تلاش‌ها - تلاش - 1
    if باقیمانده > 0:
        رمز = input(f"اشتباه! {باقیمانده} تلاش باقی: ")
    else:
        رمز = ""
else:
    # حلقه بدون break تمام شد
    print("دسترسی رد شد - تلاش‌های ناموفق زیاد")
```

---

## الگوهای رایج

### الگوی ۱: پیدا کردن و پردازش اولین تطابق

```python
def پیدا_و_پردازش(آیتم‌ها, شرط, پردازش):
    """پیدا کردن اولین آیتم مطابق شرط و پردازش آن."""
    for آیتم in آیتم‌ها:
        if شرط(آیتم):
            پردازش(آیتم)
            return True  # پیدا و پردازش شد
    return False  # پیدا نشد

# مثال: پیدا کردن اولین محصول گران و اعمال تخفیف
محصولات = [
    {"name": "خودکار", "price": 2},
    {"name": "کتاب", "price": 15},
    {"name": "لپ‌تاپ", "price": 1000},
]

def گران_است(p): return p["price"] > 100
def تخفیف_بده(p): 
    p["price"] *= 0.9
    print(f"تخفیف به {p['name']}: ${p['price']:.2f}")

پیدا_شد = پیدا_و_پردازش(محصولات, گران_است, تخفیف_بده)
if not پیدا_شد:
    print("محصول گرانی پیدا نشد")
```

### الگوی ۲: رد کردن آیتم‌های نامعتبر

```python
def پردازش_آیتم‌های_معتبر(داده, اعتبارسنج, پردازش):
    """پردازش فقط آیتم‌های معتبر، رد کردن نامعتبرها."""
    نتایج = []
    
    for آیتم in داده:
        if not اعتبارسنج(آیتم):
            print(f"رد کردن نامعتبر: {آیتم}")
            continue
        
        نتیجه = پردازش(آیتم)
        نتایج.append(نتیجه)
    
    return نتایج

# مثال: پردازش فقط اعداد مثبت
def مثبت_است(x): return x > 0
def دو_برابر(x): return x * 2

اعداد = [5, -3, 8, -1, 10]
نتایج = پردازش_آیتم‌های_معتبر(اعداد, مثبت_است, دو_برابر)
print(f"نتایج: {نتایج}")  # [10, 16, 20]
```

### الگوی ۳: منو با کنترل حلقه

```python
def نمایش_منو():
    print("\n=== منو ===")
    print("۱. افزودن آیتم")
    print("۲. مشاهده آیتم‌ها")
    print("۳. خروج")

آیتم‌ها = []

while True:
    نمایش_منو()
    انتخاب = input("انتخاب کن: ")
    
    if انتخاب == "۳":
        print("خداحافظ!")
        break
    
    if انتخاب == "۱":
        آیتم = input("آیتم را وارد کن: ")
        if آیتم.strip() == "":
            print("نمی‌توان آیتم خالی اضافه کرد!")
            continue
        آیتم‌ها.append(آیتم)
        print(f"اضافه شد: {آیتم}")
    
    elif انتخاب == "۲":
        if not آیتم‌ها:
            print("هنوز آیتمی نیست!")
            continue
        print("آیتم‌ها:")
        for i, آیتم in enumerate(آیتم‌ها, 1):
            print(f"  {i}. {آیتم}")
    
    else:
        print("انتخاب نامعتبر!")
```

---

## اشتباهات رایج مبتدی‌ها

### اشتباه ۱: استفاده از `continue` یا `break` خارج از حلقه

```python
# ❌ اشتباه - SyntaxError
def کمک():
    if x < 0:
        continue  # 'continue' در حلقه نیست

# ✅ درست
def کمک():
    for x in آیتم‌ها:
        if x < 0:
            continue
```

### اشتباه ۲: فراموش کردن که `break` فقط از داخلی‌ترین حلقه خارج می‌شود

```python
# ❌ اشتباه - فقط از حلقه داخلی خارج می‌شود
پیدا_شد = False
for سطر in ماتریس:
    for سلول in سطر:
        if سلول == هدف:
            پیدا_شد = True
            break
    # هنوز در حلقه خارجی هستیم!

# ✅ درست - استفاده از پرچم برای خروج از هر دو
پیدا_شد = False
for سطر in ماتریس:
    if پیدا_شد:
        break
    for سلول in سطر:
        if سلول == هدف:
            پیدا_شد = True
            break
```

### اشتباه ۳: اشتباه گرفتن `else` حلقه با `if-else`

```python
# ❌ درک اشتباه
for x in آیتم‌ها:
    if x > 10:
        print("بزرگ!")
    else:  # این هر تکرار اجرا می‌شود!
        print("بزرگ نیست")

# ✅ درست - استفاده from for-else برای جستجو
for x in آیتم‌ها:
    if x == هدف:
        print("پیدا شد!")
        break
else:  # این فقط اگر حلقه بدون break تمام شود اجرا می‌شود
    print("پیدا نشد")
```

### اشتباه ۴: استفاده از `continue` برای رد کردن آخرین تکرار

```python
# ❌ اشتباه - استفاده از continue وقتی باید حلقه را متفاوت تعریف کنیم
for i in range(10):
    if i == 9:
        continue  # رد کردن آخرین تکرار
    print(i)

# ✅ درست - فقط تا ۹ حلقه بزن
for i in range(9):
    print(i)
```

### اشتباه ۵: فکر کردن که `break` از تابع خارج می‌شود

```python
# ❌ اشتباه - تابع None برمی‌گرداند
def پیدا_کردن_اولین_مثبت(اعداد):
    for n in اعداد:
        if n > 0:
            break  # از حلقه خارج می‌شود، نه تابع!

# ✅ درست
نتیجه = پیدا_کردن_اولین_مثبت([-5, -3, 2, 8])
print(نتیجه)  # None! (نه ۲)

# ✅ نسخه درست
def پیدا_کردن_اولین_مثبت(اعداد):
    for n in اعداد:
        if n > 0:
            return n  # خروج از تابع با مقدار
    return None  # پیدا نشد
```

---

## خودتان امتحان کنید: تمرین‌ها

### تمرین ۱: پیدا کردن و توقف

اولین عدد بخش‌پذیر بر ۳ و ۵ را پیدا کن:

```python
اعداد = [4, 7, 10, 12, 15, 18, 20, 25]

for عدد in اعداد:
    if عدد % 3 == 0 and عدد % 5 == 0:
        print(f"اولین بخش‌پذیر بر هر دو: {عدد}")
        break
else:
    print("عددی بخش‌پذیر بر ۳ و ۵ پیدا نشد")
```

### تمرین ۲: پردازش فقط معتبرها

رد کردن ایمیل‌های نامعتبر:

```python
ایمیل‌ها = [
    "user@example.com",
    "invalid-email",
    "another@domain.org",
    "not-an-email",
    "test@site.net"
]

معتبرها = []
for ایمیل in ایمیل‌ها:
    if "@" not in ایمیل or "." not in ایمیل:
        print(f"نامعتبر: {ایمیل}")
        continue
    معتبرها.append(ایمیل)

print(f"ایمیل‌های معتبر: {معتبرها}")
```

### تمرین ۳: ورود با تلاش‌های محدود

```python
رمز_صحیح = "secret123"
حداکثر_تلاش = 3

for تلاش in range(حداکثر_تلاش):
    رمز = input(f"تلاش {تلاش + 1}/{حداکثر_تلاش}: ")
    
    if رمز == رمز_صحیح:
        print("خوش آمدید!")
        break
else:
    print("حساب قفل شد!")
```

### تمرین ۴: رفع اشکالات

```python
# برنامه با اشکال
def پیدا_کردن_اولین_زوج(اعداد):
    for n in اعداد:
        if n % 2 == 0:
            print(f"پیدا شد: {n}")
            break
    else:
        return None
    return n

def پردازش_داده(داده):
    مجموع = 0
    for آیتم in داده:
        if آیتم < 0:
            print("رد کردن منفی")
            continue
        مجموع = مجموع + آیتم
    return مجموع

# تست
نتیجه = پیدا_کردن_اولین_زوج([1, 3, 5])
print(نتیجه)
```

<details>
<summary>برای دیدن پاسخ کلیک کنید</summary>

```python
# برنامه رفع شده
def پیدا_کردن_اولین_زوج(اعداد):
    for n in اعداد:
        if n % 2 == 0:
            print(f"پیدا شد: {n}")
            return n  # برگرداندن مقدار پیدا شده
    return None  # اگر پیدا نشد None برگردان

def پردازش_داده(داده):
    مجموع = 0
    for آیتم in داده:
        if آیتم < 0:
            print("رد کردن منفی")
            continue
        مجموع = مجموع + آیتم
    return مجموع

# تست
نتیجه = پیدا_کردن_اولین_زوج([1, 3, 5, 8, 10])
print(نتیجه)  # 8

نتیجه = پیدا_کردن_اولین_زوج([1, 3, 5])
print(نتیجه)  # None
```
</details>

---

## مرجع سریع

### دستورات کنترل حلقه

| دستور | کاری که انجام می‌دهد | چه موقع استفاده شود |
|-----------|--------------|-------------|
| `break` | فوراً از حلقه خارج شو | چیزی را پیدا کردید |
| `continue` | به تکرار بعدی برو | آیتم فعلی صلاحیت ندارد |
| `else` (با حلقه) | اگر break رخ نداد اجرا شود | جستجو/اعتبارسنجی تطابق نداشت |

### الگوهای رایج

| الگو | مثال کد |
|---------|--------------|
| پیدا کردن اولین تطابق | `for x in items:`<br>`  if match(x):`<br>`    process(x)`<br>`    break` |
| رد کردن نامعتبر | `for x in items:`<br>`  if not valid(x):`<br>`    continue`<br>`  process(x)` |
| جستجو با else | `for x in items:`<br>`  if x == target:`<br>`    found = True`<br>`    break`<br>`else:`<br>`  print("پیدا نشد")` |
| حلقه منو | `while True:`<br>`  show_menu()`<br>`  if quit: break` |

### Break در مقابل Continue در مقابل Else

| سناریو | break | continue | else |
|----------|-------|----------|------|
| خروج زودهنگام از حلقه | ✓ | ✗ | ✗ |
| رد کردن به آیتم بعدی | ✗ | ✓ | ✗ |
| اجرا پس از اتمام عادی | ✗ | ✗ | ✓ |
| کار در حلقه for | ✓ | ✓ | ✓ |
| کار در حلقه while | ✓ | ✓ | ✓ |

---

## نکات کلیدی

۱. **`break`** کل حلقه را فوراً متوقف می‌کند
۲. **`continue`** بقیه تکرار فعلی را رد می‌کند و به بعدی می‌رود
۳. **`else` حلقه** فقط اگر حلقه به طور عادی تمام شود (بدون `break`) اجرا می‌شود
۴. **`break` فقط از داخلی‌ترین حلقه خارج می‌شود** - از پرچم‌ها برای خروج از حلقه‌های تو در تو استفاده کنید
۵. **`continue` و `break`** فقط در حلقه‌ها کار می‌کنند، نه در توابع
۶. **از `else` با حلقه** برای سناریوهای "پیدا نشد" یا "تطابق نداشت" استفاده کنید
۷. **از پرچم‌ها** (متغیرهای بولی) وقتی نیاز به ارتباط بین حلقه‌های تو در تو دارید استفاده کنید

---

## گام بعدی

حالا که می‌توانید با break، continue و else حلقه‌ها را کنترل کنید:
- الگوریتم‌های جستجوی کارآمدتر می‌نویسید
- موارد خاص و داده‌های نامعتبر را به خوبی مدیریت می‌کنید
- برنامه‌های تعاملی با کنترل جریان مناسب می‌سازید
- به سمت ساختارهای داده پیشرفته‌تر (لیست‌ها، دیکشنری‌ها) می‌روید
